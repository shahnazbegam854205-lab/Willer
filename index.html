<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="theme-color" content="#0f172a">
    <title>ðŸš€ AI Website Factory</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === MOBILE FIRST CSS === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: #0f172a;
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* === SCREEN 1: TERMS & CONDITIONS === */
        #termsScreen {
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
        }
        
        .logo {
            text-align: center;
            padding: 30px 0;
        }
        
        .logo h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .logo p {
            color: #94a3b8;
            font-size: 1.1rem;
        }
        
        .terms-container {
            background: #1e293b;
            border-radius: 20px;
            padding: 25px;
            border: 1px solid #334155;
            margin: 20px 0;
            flex: 1;
            overflow-y: auto;
            max-height: 50vh;
        }
        
        .terms-container h2 {
            color: #8b5cf6;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        
        .terms-content {
            color: #cbd5e1;
            line-height: 1.6;
        }
        
        .terms-content h3 {
            color: #f8fafc;
            margin: 20px 0 10px;
            font-size: 1.2rem;
        }
        
        .terms-content ul {
            padding-left: 20px;
            margin: 10px 0;
        }
        
        .terms-content li {
            margin-bottom: 8px;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(139, 92, 246, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #8b5cf6;
        }
        
        #agreeCheckbox {
            width: 24px;
            height: 24px;
            accent-color: #8b5cf6;
        }
        
        .checkbox-label {
            color: #f8fafc;
            font-size: 1rem;
        }
        
        .get-started-btn {
            width: 100%;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-top: 20px;
            transition: all 0.3s;
        }
        
        .get-started-btn:active {
            transform: scale(0.98);
        }
        
        .get-started-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* === SCREEN 2: CHAT AGENT === */
        #chatScreen {
            min-height: 100vh;
            display: none;
            flex-direction: column;
        }
        
        .chat-header {
            background: #1e293b;
            padding: 20px;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .agent-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .agent-avatar {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #8b5cf6, #3b82f6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-bottom: 100px;
        }
        
        .message {
            max-width: 85%;
            padding: 15px;
            border-radius: 18px;
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .ai-message {
            background: #1e293b;
            border: 1px solid #334155;
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .user-message {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .chat-input-area {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #0f172a;
            padding: 15px;
            border-top: 1px solid #334155;
            display: flex;
            gap: 10px;
            padding-bottom: max(15px, env(safe-area-inset-bottom));
        }
        
        #chatInput {
            flex: 1;
            background: #334155;
            border: 2px solid #475569;
            border-radius: 12px;
            padding: 15px;
            color: white;
            font-size: 1rem;
            outline: none;
            resize: none;
            min-height: 50px;
            max-height: 120px;
        }
        
        #chatInput:focus {
            border-color: #8b5cf6;
        }
        
        .send-btn {
            background: #8b5cf6;
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 12px;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .send-btn:active {
            transform: scale(0.95);
        }
        
        .typing-indicator {
            display: none;
            padding: 10px 15px;
            background: #1e293b;
            border-radius: 18px;
            align-self: flex-start;
            border: 1px solid #334155;
        }
        
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
        
        /* === SCREEN 3: WEBSITE CREATED === */
        #resultScreen {
            min-height: 100vh;
            padding: 20px;
            display: none;
            flex-direction: column;
            background: linear-gradient(135deg, #0f172a 0%, #134e4a 100%);
        }
        
        .result-header {
            text-align: center;
            padding: 40px 0 30px;
        }
        
        .success-icon {
            font-size: 4rem;
            color: #10b981;
            margin-bottom: 20px;
            animation: bounce 1s;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }
        
        .website-preview {
            background: #1e293b;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #10b981;
        }
        
        .preview-frame {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 10px;
            border: none;
            margin-bottom: 15px;
        }
        
        .url-box {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .url-box a {
            color: #3b82f6;
            text-decoration: none;
            flex: 1;
            word-break: break-all;
            font-size: 0.95rem;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 30px;
        }
        
        .action-btn {
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .action-btn:active {
            transform: scale(0.98);
        }
        
        .primary-btn {
            background: #3b82f6;
            color: white;
        }
        
        .secondary-btn {
            background: #1e293b;
            color: white;
            border: 1px solid #334155;
        }
        
        /* === RESPONSIVE === */
        @media (min-width: 768px) {
            .container {
                max-width: 500px;
                margin: 0 auto;
            }
            
            .terms-container {
                max-height: 60vh;
            }
            
            .preview-frame {
                height: 400px;
            }
        }
        
        /* === UTILITIES === */
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 30px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(139, 92, 246, 0.1);
            border-top: 4px solid #8b5cf6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- SCREEN 1: Terms & Conditions -->
    <div id="termsScreen">
        <div class="container">
            <div class="logo">
                <h1>ðŸš€ AI Website Factory</h1>
                <p>Create websites instantly with AI chat</p>
            </div>
            
            <div class="terms-container">
                <h2><i class="fas fa-file-contract"></i> Terms & Conditions</h2>
                <div class="terms-content">
                    <h3>1. Service Description</h3>
                    <p>This AI-powered service generates websites based on your chat descriptions. Each website is created as a unique project.</p>
                    
                    <h3>2. User Responsibilities</h3>
                    <ul>
                        <li>You must provide clear website descriptions</li>
                        <li>Generated content should not violate any laws</li>
                        <li>You're responsible for the websites you create</li>
                        <li>Keep generated URLs secure</li>
                    </ul>
                    
                    <h3>3. AI Agent System</h3>
                    <p>Each website is managed by a dedicated AI agent. You'll have a persistent chat session with your agent.</p>
                    
                    <h3>4. Hosting on Vercel</h3>
                    <p>Websites are automatically deployed on Vercel's platform. You agree to Vercel's Terms of Service for hosting.</p>
                    
                    <h3>5. Privacy</h3>
                    <p>Your chat conversations are used solely for website generation and are not shared with third parties.</p>
                    
                    <h3>6. Acceptable Use</h3>
                    <ul>
                        <li>No illegal or harmful content</li>
                        <li>No spam or automated requests</li>
                        <li>Respect Vercel's fair use policy</li>
                        <li>Commercial use requires Vercel Pro plan</li>
                    </ul>
                </div>
                
                <div class="checkbox-container">
                    <input type="checkbox" id="agreeCheckbox">
                    <label for="agreeCheckbox" class="checkbox-label">
                        I agree to all Terms & Conditions. I understand each website gets a dedicated AI agent.
                    </label>
                </div>
                
                <button class="get-started-btn" onclick="startChat()" id="startBtn" disabled>
                    <i class="fas fa-comments"></i> Accept & Start Chat with AI Agent
                </button>
            </div>
        </div>
    </div>
    
    <!-- SCREEN 2: Chat Agent -->
    <div id="chatScreen">
        <div class="chat-header">
            <div class="agent-info">
                <div class="agent-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h3>AI Website Agent</h3>
                    <p style="color: #94a3b8; font-size: 0.9rem;">Ready to build your website</p>
                </div>
            </div>
            <div style="color: #94a3b8; font-size: 0.9rem;">
                <i class="fas fa-shield-alt"></i> Secure Session
            </div>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will appear here -->
            <div class="message ai-message">
                <strong>ðŸ¤– AI Agent:</strong> Hello! I'm your dedicated website builder agent. Describe the website you want to create, and I'll build it for you live on Vercel. What would you like to build today?
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="chat-input-area">
            <textarea 
                id="chatInput" 
                placeholder="Describe your website... Example: 'Create a business website for a coffee shop with menu, location, and contact form'"
                rows="1"
                onkeydown="handleKeyPress(event)"
            ></textarea>
            <button class="send-btn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <!-- SCREEN 3: Website Created -->
    <div id="resultScreen">
        <div class="container">
            <div class="result-header">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2>ðŸŽ‰ Website Created!</h2>
                <p style="color: #94a3b8;">Your website is now live on the internet</p>
            </div>
            
            <div class="website-preview">
                <h3><i class="fas fa-eye"></i> Live Preview</h3>
                <iframe class="preview-frame" id="websitePreview" src="about:blank"></iframe>
                
                <div class="url-box">
                    <i class="fas fa-globe" style="color: #3b82f6;"></i>
                    <a href="#" id="liveUrl" target="_blank"></a>
                    <button class="action-btn secondary-btn" onclick="copyUrl('liveUrl')" style="padding: 8px 16px;">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                
                <div class="url-box">
                    <i class="fab fa-github"></i>
                    <a href="#" id="githubUrl" target="_blank"></a>
                    <button class="action-btn secondary-btn" onclick="copyUrl('githubUrl')" style="padding: 8px 16px;">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
                
                <p style="color: #94a3b8; font-size: 0.9rem; margin-top: 10px;">
                    <i class="fas fa-info-circle"></i> This website is managed by your AI agent. You can request changes anytime.
                </p>
            </div>
            
            <div class="action-buttons">
                <button class="action-btn primary-btn" onclick="visitWebsite()">
                    <i class="fas fa-external-link-alt"></i> Visit Website
                </button>
                <button class="action-btn secondary-btn" onclick="backToChat()">
                    <i class="fas fa-comment"></i> Back to Agent
                </button>
                <button class="action-btn secondary-btn" onclick="createNewWebsite()">
                    <i class="fas fa-plus"></i> New Website
                </button>
                <button class="action-btn secondary-btn" onclick="manageAgent()">
                    <i class="fas fa-cog"></i> Agent Settings
                </button>
            </div>
        </div>
    </div>
    
    <!-- Loading Screen -->
    <div class="loading hidden" id="loadingScreen">
        <div class="spinner"></div>
        <h3 id="loadingText">Creating your website...</h3>
        <p style="color: #94a3b8;">This may take 30-60 seconds</p>
    </div>

    <script>
        // ====== MAIN JAVASCRIPT ======
        
        // DOM Elements
        const termsScreen = document.getElementById('termsScreen');
        const chatScreen = document.getElementById('chatScreen');
        const resultScreen = document.getElementById('resultScreen');
        const loadingScreen = document.getElementById('loadingScreen');
        const agreeCheckbox = document.getElementById('agreeCheckbox');
        const startBtn = document.getElementById('startBtn');
        const chatInput = document.getElementById('chatInput');
        const chatMessages = document.getElementById('chatMessages');
        const typingIndicator = document.getElementById('typingIndicator');
        const websitePreview = document.getElementById('websitePreview');
        const liveUrl = document.getElementById('liveUrl');
        const githubUrl = document.getElementById('githubUrl');
        
        // User session data
        let userSession = {
            agentId: null,
            websites: [],
            currentWebsite: null
        };
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Check terms agreement
            agreeCheckbox.addEventListener('change', function() {
                startBtn.disabled = !this.checked;
            });
            
            // Auto-resize textarea
            chatInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Generate unique agent ID
            userSession.agentId = 'agent_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            console.log('Agent ID:', userSession.agentId);
        });
        
        // Start chat with AI Agent
        function startChat() {
            if (!agreeCheckbox.checked) {
                alert('Please agree to the Terms & Conditions');
                return;
            }
            
            // Switch to chat screen
            termsScreen.style.display = 'none';
            chatScreen.style.display = 'flex';
            
            // Focus on chat input
            setTimeout(() => {
                chatInput.focus();
            }, 300);
        }
        
        // Send message to AI Agent
        async function sendMessage() {
            const message = chatInput.value.trim();
            
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            // Add user message to chat
            addMessage(message, 'user');
            chatInput.value = '';
            chatInput.style.height = 'auto';
            
            // Show typing indicator
            typingIndicator.style.display = 'block';
            scrollToBottom();
            
            try {
                // Send to backend
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        agentId: userSession.agentId,
                        sessionId: userSession.agentId
                    })
                });
                
                const data = await response.json();
                
                // Hide typing indicator
                typingIndicator.style.display = 'none';
                
                if (data.action === 'generate_website') {
                    // AI wants to generate website
                    addMessage(data.response, 'ai');
                    
                    // Show loading and generate website
                    showLoading('Building your website...');
                    await generateWebsite(message);
                    
                } else if (data.action === 'clarify') {
                    // AI needs clarification
                    addMessage(data.response, 'ai');
                    
                } else {
                    // Regular response
                    addMessage(data.response, 'ai');
                }
                
            } catch (error) {
                console.error('Chat error:', error);
                typingIndicator.style.display = 'none';
                addMessage('Sorry, there was an error. Please try again.', 'ai');
            }
            
            scrollToBottom();
        }
        
        // Generate website from description
        async function generateWebsite(description) {
            try {
                const response = await fetch('/api/generate-website', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        description: description,
                        agentId: userSession.agentId
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Hide loading
                    hideLoading();
                    
                    // Store website data
                    userSession.currentWebsite = {
                        url: data.url,
                        github: data.github,
                        description: description,
                        created: new Date().toISOString()
                    };
                    
                    userSession.websites.push(userSession.currentWebsite);
                    
                    // Show result screen
                    showResultScreen(data.url, data.github);
                    
                } else {
                    hideLoading();
                    addMessage('Error creating website: ' + data.error, 'ai');
                }
                
            } catch (error) {
                console.error('Generate error:', error);
                hideLoading();
                addMessage('Failed to create website. Please try again.', 'ai');
            }
        }
        
        // Show result screen with website
        function showResultScreen(url, github) {
            chatScreen.style.display = 'none';
            resultScreen.style.display = 'flex';
            
            // Set URLs
            liveUrl.href = url;
            liveUrl.textContent = url;
            githubUrl.href = github;
            githubUrl.textContent = github;
            
            // Load preview
            websitePreview.src = url;
            
            // Save to local storage
            saveToHistory(url, github);
        }
        
        // Add message to chat
        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            if (sender === 'ai') {
                messageDiv.innerHTML = `<strong>ðŸ¤– AI Agent:</strong> ${text}`;
            } else {
                messageDiv.innerHTML = `<strong>ðŸ‘¤ You:</strong> ${text}`;
            }
            
            chatMessages.appendChild(messageDiv);
            scrollToBottom();
        }
        
        // Show loading screen
        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            loadingScreen.classList.remove('hidden');
        }
        
        // Hide loading screen
        function hideLoading() {
            loadingScreen.classList.add('hidden');
        }
        
        // Scroll to bottom of chat
        function scrollToBottom() {
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Handle Enter key in chat
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // Copy URL to clipboard
        function copyUrl(type) {
            const url = type === 'liveUrl' ? liveUrl.href : githubUrl.href;
            navigator.clipboard.writeText(url).then(() => {
                alert('URL copied to clipboard!');
            });
        }
        
        // Visit website
        function visitWebsite() {
            window.open(liveUrl.href, '_blank');
        }
        
        // Back to chat with agent
        function backToChat() {
            resultScreen.style.display = 'none';
            chatScreen.style.display = 'flex';
            
            // Add message about returning
            addMessage(`Welcome back! Your website ${userSession.currentWebsite.url} is live. What changes would you like?`, 'ai');
            scrollToBottom();
        }
        
        // Create new website
        function createNewWebsite() {
            resultScreen.style.display = 'none';
            chatScreen.style.display = 'flex';
            
            // Clear chat and start fresh
            chatMessages.innerHTML = `
                <div class="message ai-message">
                    <strong>ðŸ¤– AI Agent:</strong> Let's create another website! What would you like to build this time?
                </div>
            `;
            scrollToBottom();
            chatInput.focus();
        }
        
        // Manage agent settings
        function manageAgent() {
            alert(`Agent Management:\n\nAgent ID: ${userSession.agentId}\nWebsites Created: ${userSession.websites.length}\n\nFeatures:\nâ€¢ Each website has dedicated agent\nâ€¢ Chat history preserved\nâ€¢ Quick modifications`);
        }
        
        // Save to browser history
        function saveToHistory(url, github) {
            try {
                const history = JSON.parse(localStorage.getItem('aiWebsites') || '[]');
                history.unshift({
                    url: url,
                    github: github,
                    agent: userSession.agentId,
                    date: new Date().toLocaleString()
                });
                
                if (history.length > 10) history.pop();
                localStorage.setItem('aiWebsites', JSON.stringify(history));
            } catch (e) {
                console.log('Storage error:', e);
            }
        }
        
        // Mobile optimizations
        function initMobile() {
            // Prevent zoom on double-tap
            document.addEventListener('touchstart', function(e) {
                if (e.touches.length > 1) e.preventDefault();
            }, { passive: false });
            
            // Adjust for mobile keyboard
            window.addEventListener('resize', function() {
                if (window.visualViewport) {
                    document.body.style.height = window.visualViewport.height + 'px';
                }
            });
        }
        
        // Initialize mobile features
        initMobile();
    </script>
</body>
</html>
